image: {{ image }}
{% if rhnregister %}
  rhnregister: true
{% endif %}
{% if rhnorg %}
  rhnorg: {{ rhnorg }}
{% endif %}
{% if rhnactivationkey %}
  rhnactivationkey: {{ rhnactivationkey }}
{% endif %}
numcpus: {{ numcpus }}
memory: {{ memory }}
nets:
  - name: {{ net_name }}
disks:
  - size: {{ disk_size }}
cmds:
  - nmcli connection modify  "cloud-init eth0"  ipv4.dns {{ reservedns }}
  - nmcli connection down "cloud-init eth0" && sudo nmcli connection up "cloud-init eth0"
  - echo {{ user_password }} | passwd --stdin root
  - useradd {{ user }}
  - usermod -aG wheel {{ user }}
  - echo "{{ user }} ALL=(root) NOPASSWD:ALL" | tee -a /etc/sudoers.d/{{ user }}
  - echo {{ user_password }} | passwd --stdin {{ user }}
  - hostnamectl set-hostname mirror-registry.{{ domain }}
  - subscription-manager refresh
  - subscription-manager attach --auto
files:
  - path: /root/pull-secret.json
    origin: ~/.generated/vmfiles/pull-secret.json
  - path: /home/{{ user }}/pull-secret.json
    origin:  ~/.generated/vmfiles/pull-secret.json
  - path: /home/{{ user }}/mirror-registry.{{ domain }}.crt
    origin: /root/.generated/vmfiles/mirror-registry.{{ domain }}.crt
  - path:  /home/{{ user }}/mirror-registry.{{ domain }}.key
    origin:  /root/.generated/vmfiles/mirror-registry.{{ domain }}.key